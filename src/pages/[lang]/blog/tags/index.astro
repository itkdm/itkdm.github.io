---
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import type { Lang } from '../../../../i18n/config';
import { SUPPORTED_LANGS } from '../../../../i18n/config';

export function getStaticPaths() {
	return SUPPORTED_LANGS.map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: Lang };
const posts = await getCollection('blog', (entry) => entry.data.lang === lang && !entry.data.draft);
const tags = new Map<string, number>();
for (const post of posts) {
	for (const tag of post.data.tags) {
		tags.set(tag, (tags.get(tag) ?? 0) + 1);
	}
}
const tagList = Array.from(tags.entries()).sort((a, b) => b[1] - a[1]);
const maxCount = tagList.length > 0 ? tagList[0][1] : 1;
---

<BaseLayout
	lang={lang}
	title={lang === 'zh' ? '标签' : 'Tags'}
	description={lang === 'zh' ? '文章标签列表' : 'Blog tags'}
	currentPath={`/${lang}/blog/tags/`}
>
	<section class="section">
		<div class="section-head">
			<h2>{lang === 'zh' ? '所有标签' : 'All Tags'}</h2>
			<p class="faint">{lang === 'zh' ? `共 ${tagList.length} 个标签` : `${tagList.length} tags`}</p>
		</div>
		{tagList.length === 0 ? (
			<p class="faint">{lang === 'zh' ? '暂无标签。' : 'No tags yet.'}</p>
		) : (
			<div style="display: flex; flex-wrap: wrap; gap: 10px;">
				{tagList.map(([tag, count]) => {
					const size = Math.max(12, 12 + (count / maxCount) * 6);
					return (
						<a
							href={`/${lang}/blog/tags/${encodeURIComponent(tag)}/`}
							class="tag"
							style={`font-size: ${size}px; padding: 6px 12px;`}
						>
							{tag} <span style="opacity: 0.7;">({count})</span>
						</a>
					);
				})}
			</div>
		)}
	</section>
</BaseLayout>
